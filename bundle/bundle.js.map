{"version":3,"sources":["webpack:///webpack/bootstrap d7e9196f9dafecedcc70","webpack:///./lib/update_instances.js","webpack:///./lib/main.js","webpack:///./lib/map.js","webpack:///./lib/update_chart.js","webpack:///./lib/listener_installer.js","webpack:///./lib/util/fetchData.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;AC7DA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,EAAE;AACxB;AACA;AACA,UAAU,6CAA6C;AACvD,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,cAAc;AAC/B;AACA;;AAEA;AACA;AACA,qBAAqB,EAAE;AACvB;AACA;AACA;AACA;;;AAGA;;;;;;;;;;;AC5DA;AACuC;;AAEvC;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH,CAAC;;;;;;;;;;;;ACTD;AACA;AACA;AACgC;;;AAGhC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,KAAK;;AAEL;;AAEA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;AClFA;AACA;AACA;AACA;AACA,wBAAwB,6BAA6B,GAAG,kBAAkB;AAC1E;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,wCAAwC,QAAQ,kBAAkB;AAClE;AACA;;;AAGA;;;;;;;;;AClFA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;;;;;;;;AC3DA;AACA;AACA;AAAA;AAAA;;AAEA;AACA;AACA;AAAA;AAAA;;AAEA;AACA;AACA;AAAA;AAAA;;AAEA;AACA;AACA;AAAA;AAAA","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d7e9196f9dafecedcc70","const updateInstances = (data) => {\n  const projection = d3.geoAlbersUsa().scale(1280).translate([960/2, 600/2]);\n  const map = d3.select(\"svg\");\n  const circles = map.selectAll(\".circle-instances\").remove().exit();\n\n  circles.data(data)\n    .enter().append(\"circle\")\n    .attr(\"class\", \"circle-instances\")\n    .on(\"mouseover\", handleMouseOver)\n    .on(\"mouseout\", handleMouseOut)\n    .attr(\"fill\", datum => {\n      if (datum.sources) return \"#f70000\";\n      else return \"#ccc\";\n    })\n    .attr(\"stroke\", \"black\")\n    .attr(\"cx\", datum => projection([datum.longitude, datum.latitude])[0])\n    .attr(\"cy\", datum => projection([datum.longitude, datum.latitude])[1])\n    .attr(\"r\", 0.5)\n    .transition().duration(750)\n    .attr(\"r\", datum => Math.sqrt(datum.total_victims));\n  \n  // function declaration is hoisted\n  function handleMouseOver (datum, i) {\n    if (datum.sources) {\n      const currentCircle = d3.event.target;\n      const svg = d3.select(\"svg\");\n      const dialogue = svg.append(\"polygon\")\n      .attr(\"id\", `c${i}`)\n      .attr(\"points\", \"0,0 0,160 300,160 300,0 50,0 37.5,-15 25,0\")\n      .attr(\"transform\", `translate(\n        ${currentCircle.attributes.cx.nodeValue - 37.5},\n        ${parseFloat(currentCircle.attributes.cy.nodeValue) + 30}\n      )`)\n      .attr(\"fill\", \"#D8D8D8\")\n      .attr(\"opacity\", 0)\n      .transition()\n      .duration(500)\n      .attr(\"opacity\", 0.75);\n  \n      const container = svg.append(\"foreignObject\")\n      .attr(\"width\", 300)\n      .attr(\"height\", 160)\n      .attr(\"x\", currentCircle.attributes.cx.nodeValue - 37.5)\n      .attr(\"y\", parseFloat(currentCircle.attributes.cy.nodeValue) + 30);\n  \n      container.append(\"xhtml:div\")\n        .append(\"p\")\n        .html(`${datum.summary}`);\n    }\n  }\n  \n  function handleMouseOut (datum, i) {\n    if (datum.sources) {\n      d3.select(`#c${i}`).remove();\n      d3.select(\"foreignObject\").remove();\n    }\n  }\n  };\n\n\nexport default updateInstances;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/update_instances.js\n// module id = 0\n// module chunks = 0","import initMap from './map';\nimport { fetchInstance, fetchGunSales } from './util/fetchData';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  fetchGunSales().then(gunSales => {\n    fetchInstance().then(instances => {\n      initMap(gunSales, instances);\n    });\n  });\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/main.js\n// module id = 1\n// module chunks = 0","import updateChart from './update_chart';\nimport updateInstances from './update_instances';\nimport listenerInstaller from './listener_installer';\nimport { fetchMap, fetchStates } from './util/fetchData';\n\n\nconst initMap = (gunSales, instances) => {\n  fetchMap().then(us => {\n    fetchStates().then(stateNames => {\n      \n      const usData = topojson.feature(us, us.objects.states).features;\n      const svg = d3.select(\"svg\");\n      const path = d3.geoPath(null);\n      const nameHash = {};\n      stateNames.forEach(name => {\n        nameHash[name.id] = name.name;\n      });\n\n      svg.append(\"g\")\n        .attr(\"class\", \"states\")\n        .selectAll(\"path\")\n        .data(usData)\n        .enter().append(\"path\")\n        .attr(\"d\", path)\n        .attr(\"id\", datum => datum.id);\n\n      svg.append(\"path\")\n        .attr(\"class\", \"state-borders\")\n        .attr(\"d\", path(topojson.mesh(us, us.objects.states, (a, b) => a !== b )));\n\n      svg.append(\"g\")\n        .attr(\"class\", \"state-names\")\n        .selectAll(\"text\")\n        .data(usData)\n        .enter().append(\"text\")\n        .text(datum => {\n          if (datum.id[0] === \"0\") {\n            return nameHash[datum.id[1]];\n          } else {\n            return nameHash[datum.id];\n          }\n        })\n        .attr(\"x\", datum => path.centroid(datum)[0])\n        .attr(\"y\", datum => path.centroid(datum)[1])\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"fill\", \"#6f9ba5\")\n        .on(\"click\", handleClick);\n\n      mountInstances(instances);\n      });\n  });\n\n  const handleClick = datum => {\n    const state = d3.event.target.textContent;\n    const selectedYear = document.getElementById(\"year-options\").value;\n    if (!selectedYear) {\n      window.alert(\"Please select a year!\");\n      return;\n    } else if (selectedYear === 'old') {\n      window.alert(\"No background check records before 2014!\");\n      return;\n    }\n  \n    const filteredGunSales = gunSales.filter(sale => {\n      return sale.month.slice(2,4) === selectedYear && sale.state === state;\n    });\n  \n    const filteredInstances = instances.filter(instance => {\n\n      return instance.date.slice(instance.date.length - 2) === selectedYear && instance.location === state;\n    });\n\n    updateChart(filteredGunSales, filteredInstances);\n  };\n\n  const mountInstances = instances => {\n    updateInstances(instances);\n    const installer = new listenerInstaller(instances);\n    installer.install();\n  };\n};\n\nexport default initMap;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/map.js\n// module id = 2\n// module chunks = 0","const updateChart = (gunsales, instances) => {\n  const x = d3.scaleBand().rangeRound([0, 400]),\n        y = d3.scaleLinear().rangeRound([400, 0]),\n        barWidth = 400 / 2 / gunsales.length,\n        chartTitle = `${gunsales[0].month.slice(0,4)} ${gunsales[0].state} Firearm Background Checks`;\n        instances = parseInstances(instances);\n\n  gunsales.reverse();\n\n  x.domain(gunsales.map(datum => datum.month.slice(datum.month.length - 2)));\n  y.domain([0, d3.max(gunsales, (datum) => parseInt(datum.totals))]);\n\n  const svg = d3.select(\"svg\");\n  svg.selectAll(\".chart\").remove();\n  const chart = svg.append(\"g\")\n    .attr(\"class\", \"chart\")\n    .attr(\"transform\", \"translate(900, 280)\");\n\n  chart.append(\"text\")\n    .attr(\"class\", \"chart-title\")\n    .attr(\"x\", 40)\n    .attr(\"y\", -20)\n    .attr(\"fill\", \"#ccc\")\n    .attr(\"font-size\", \"15px\")\n    .text(chartTitle);\n\n\n  chart.append(\"g\")\n    .attr(\"class\", \"axis-x\")\n    .attr(\"transform\", \"translate(0, 400)\")\n    .call(d3.axisBottom(x))\n    .append(\"text\")\n    .text(\"month\")\n    .attr(\"transform\", \"translate(200, 40)\")\n    .attr(\"font-size\", \"12px\");\n\n  chart.append(\"g\")\n    .attr(\"class\", \"axis-y\")\n    .call(d3.axisLeft(y))\n    .append(\"text\")\n    .text(\"background check\")\n    .attr(\"transform\", \"rotate(-90)\")\n    .attr(\"x\", -160)\n    .attr(\"y\", -60)\n    .attr(\"font-size\", \"12px\");\n\n  chart.selectAll(\".bar\")\n    .data(gunsales)\n    .enter().append(\"rect\")\n    .attr(\"class\", \"bar\")\n    .attr(\"x\", datum => x(datum.month.slice(datum.month.length - 2)) + barWidth / 2)\n    .attr(\"y\", datum => y(parseInt(datum.totals)))\n    .transition()\n    .duration(500)\n    .attr(\"height\", datum => 400 - y(parseInt(datum.totals)))\n    .attr(\"width\", barWidth);\n\n  chart.selectAll(\".dot\")\n    .data(instances)\n    .enter().append(\"circle\")\n    .attr(\"cx\", datum => x(Object.keys(datum)[0]) + barWidth)\n    .attr(\"cy\", datum => 400 - parseInt(Object.values(datum)[0]) * 50)\n    .attr(\"fill\", \"#fff\")\n    .attr(\"r\", 0.5)\n    .transition()\n    .duration(750)\n    .attr(\"r\", Math.sqrt(barWidth));\n  \n  // function declaration is hoisted\n  function parseInstances (instances) {\n    const res = {};\n    instances.forEach(instance => {\n      let month = instance.date.split('/')[0];\n      if (month.length === 1) month = \"0\" + month;\n      if (res[month]) res[month] += 1;\n      else res[month] = 1;\n    });\n    return Object.keys(res).map(key => {return {[key]: res[key]};});\n  }\n};\n\n\nexport default updateChart;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/update_chart.js\n// module id = 4\n// module chunks = 0","import updateInstances from './update_instances';\n\nclass listenerInstaller {\n  constructor(instances) {\n    this.instances = instances;\n    this.selectorValues = {\n      \"year-options\": \"\",\n      \"gender-options\": \"\",\n      \"venue-options\": \"\",\n      \"race-options\": \"\"\n    };\n  }\n\n  install() {\n    // initial modal can not be closed until the map and instances have been mounted\n    document.getElementsByClassName('modal-screen')[0].addEventListener('click', e => {\n      document.getElementsByClassName('modal is-open')[0].classList.remove('is-open');\n    });\n\n    document.getElementsByClassName('close-modal')[0].addEventListener('click', e => {\n      document.getElementsByClassName('modal is-open')[0].classList.remove('is-open');\n    });\n\n    document.getElementsByClassName('open-modal')[0].addEventListener('click', e => {\n      document.getElementsByClassName('modal')[0].classList.add('is-open');\n    });\n\n    document.getElementById('reset').addEventListener('click', () => {\n      document.querySelectorAll(\"select\").forEach(selector => {\n        selector.selectedIndex = 0;\n        this.selectorValues[selector.className] = \"\";\n      });\n      updateInstances(this.instances);\n    });\n  \n    document.querySelectorAll('select').forEach(selector => {\n      selector.addEventListener('change', e => {\n        this.selectorValues[selector.className] = e.currentTarget.value;\n        const filteredInstances = this.filterInstances();\n        updateInstances(filteredInstances);\n      });\n    });\n  }\n  \n  filterInstances() {\n    const res = this.instances.filter(instance => {\n      let date = instance.date;\n      date = date.slice(date.length - 2);\n  \n      return (!this.selectorValues[\"year-options\"] || date === this.selectorValues[\"year-options\"] || (parseInt(date) < 14 && this.selectorValues[\"year-options\"] === \"d\")) &&\n        (!this.selectorValues[\"venue-options\"] || instance.venue === this.selectorValues[\"venue-options\"]) &&\n        (!this.selectorValues[\"gender-options\"] || instance.gender === this.selectorValues[\"gender-options\"]) &&\n        (!this.selectorValues[\"race-options\"] || instance.race.toUpperCase() === this.selectorValues[\"race-options\"].toUpperCase());\n    });\n  \n    return res;\n  }\n}\n\nexport default listenerInstaller;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/listener_installer.js\n// module id = 5\n// module chunks = 0","export const fetchMap = () => (\n    d3.json(\"https://d3js.org/us-10m.v1.json\")\n);\n\nexport const fetchStates = () => (\n    d3.tsv(\"https://gist.githubusercontent.com/mbostock/4090846/raw/07e73f3c2d21558489604a0bc434b3a5cf41a867/us-state-names.tsv\")\n);\n\nexport const fetchInstance = () => (\n    d3.csv(\"https://raw.githubusercontent.com/liamzhang40/nothing_political/master/csv/merge.csv\")\n);\n\nexport const fetchGunSales = () => (\n    d3.csv(\"https://raw.githubusercontent.com/liamzhang40/nothing_political/master/csv/nics_firearm_background_checks.csv\")\n);\n\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/util/fetchData.js\n// module id = 6\n// module chunks = 0"],"sourceRoot":""}